@page "/register"
@using Microsoft.AspNetCore.Identity
@using BlazorApp.Data
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserManager<ApplicationUser> UserManager
<PageTitle>Register</PageTitle>

<div class="register-container">
    <MudCard Style="max-width: 400px; width: 100%;">
        <MudCardContent Class="d-flex flex-column align-center"
                        Style="background-color: #161b22; padding: 30px; border-radius: 8px;
                                   box-shadow: 0 0 15px rgba(88, 166, 255, 0.5);
                                   border: 1px solid #58a6ff; font-family: 'Courier New', monospace;
                                   color: #c9d1d9;">

            <MudIcon Icon="@Icons.Material.Filled.PersonAdd" Size="Size.Large" Color="Color.Info" Class="mb-2" />
            <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-4"
                     Style="color: #58a6ff; text-shadow: 0 0 5px rgba(88, 166, 255, 0.7);">
                Create Account
            </MudText>

            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <MudAlert Severity="Severity.Error" Dense="true" Class="mb-3" Square="true"
                          Style="background-color: #0d1117; color: #c9d1d9; border: 1px solid #30363d;">
                    @ErrorMessage
                </MudAlert>
            }

            <form method="post" action="/api/register" style="width:100%;">
                <MudTextField T="string" Name="Username"
                              Placeholder="Username"
                              Variant="Variant.Filled"
                              Class="mb-3"
                              FullWidth="true"
                              Required="true"
                              Style="background-color: #0d1117; border: 1px solid #30363d; color: #c9d1d9; font-family: 'Courier New', monospace;"
                              FocusedStyle="border-color: #58a6ff; box-shadow: 0 0 8px rgba(88, 166, 255, 0.5);" />

                <MudTextField T="string" Name="Password"
                              Placeholder="Password"
                              InputType="InputType.Password"
                              Variant="Variant.Filled"
                              Class="mb-3"
                              FullWidth="true"
                              Required="true"
                              Style="background-color: #0d1117; border: 1px solid #30363d; color: #c9d1d9; font-family: 'Courier New', monospace;"
                              FocusedStyle="border-color: #58a6ff; box-shadow: 0 0 8px rgba(88, 166, 255, 0.5);" />

                <MudTextField T="string" Name="ConfirmPassword"
                              Placeholder="Confirm Password"
                              InputType="InputType.Password"
                              Variant="Variant.Filled"
                              Class="mb-4"
                              FullWidth="true"
                              Required="true"
                              Style="background-color: #0d1117; border: 1px solid #30363d; color: #c9d1d9; font-family: 'Courier New', monospace;"
                              FocusedStyle="border-color: #58a6ff; box-shadow: 0 0 8px rgba(88, 166, 255, 0.5);" />

                <MudButton Variant="Variant.Filled"
                           Color="Color.Success"
                           ButtonType="ButtonType.Submit"
                           FullWidth="true"
                           Size="Size.Large"
                           Style="border-radius:4px; background-color: #238636; transition: background-color 0.3s, box-shadow 0.3s; font-family: 'Courier New', monospace;"
                           OnMouseOver="e => e.CurrentTarget.Style.CssText += 'background-color: #2ea043; box-shadow: 0 0 10px rgba(46, 160, 67, 0.7);'"
                           OnMouseOut="e => e.CurrentTarget.Style.CssText = 'background-color: #238636; box-shadow: none;'">
                    Register
                </MudButton>
            </form>

            <MudText Typo="Typo.body2" Align="Align.Center" Class="mt-4" Style="color: #8b949e;">
                Already have an account?
                <MudLink Href="/login" Style="color: #58a6ff;">Login</MudLink>
            </MudText>
        </MudCardContent>
    </MudCard>
</div>

@if (IsAuthenticated)
{

}
else
{
    <p>Please <a href="/login">log in</a> or <a href="/register">register</a> to access more features.</p>
}


<style>
    .register-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh; /* căn giữa theo chiều dọc */
    }
</style>

@code {
    private string? ErrorMessage;
    private bool IsAuthenticated;
    private string? UserName;
    private int UserLevel;
    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity?.IsAuthenticated == true)
        {
            IsAuthenticated = true;
            UserName = user.Identity.Name;
            var appUser = await UserManager.FindByNameAsync(UserName);
            UserLevel = appUser?.Level ?? 0; // Default to User level if not found
        }
    }
}
